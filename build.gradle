plugins {
	id 'java-library'
	id 'maven-publish'
	id 'com.jfrog.bintray' version '1.8.4'
}

java {
	sourceCompatibility = targetCompatibility = JavaVersion.VERSION_1_8
	withSourcesJar()
}

repositories {
	jcenter()
}

dependencies {
	implementation files("libs/RobotCore.jar")
}

String versionstr
String releasever

if(System.getenv('VERSION')) {
	versionstr = System.getenv('VERSION')
	releasever = versionstr.substring(versionstr.indexOf('v') + 1)
} else {
	releasever = ''
}

publishing {
	publications {
		maven(MavenPublication) {
			groupId = 'com.ftc11392'
			artifactId = 'sequoia'
			version = releasever

			from components.java
		}
	}

	repositories {
		maven {
			url = "$buildDir/repo"
		}
	}
}

bintray {
	user = System.getenv('BINTRAY_USER')
	key = System.getenv('BINTRAY_API_KEY')

	publications = ['maven']

	pkg {
		repo = 'maven'
		name = 'Sequoia'
		userOrg = 'highoakrobotics'
		vcsUrl = 'https://github.com/HighOakRobotics/Sequoia'
		version {
			name = releasever
			desc = 'Release version v' + releasever + " of Sequoia. Refer to the GitHub page's readme for usage instructions. Please open an issue for any bugs."
			released  = new Date()
		}
	}
}